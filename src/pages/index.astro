---
import BaseLayout from "../layouts/BaseLayout.astro";
import HeroMedia from "../components/HeroMedia.astro";
import { site } from "../config/site";
import StoryCard from "../components/StoryCard.astro";
import { getCollection } from "astro:content";

const stories = await getCollection("stories");
const toDate = (d: unknown) => (d instanceof Date ? d : new Date(String(d)));
const sorted = stories.slice().sort((a, b) => toDate(b.data.date).getTime() - toDate(a.data.date).getTime());
const featured = sorted.filter((s) => s.data.featured).slice(0, 2);
const picks = featured.length === 2 ? featured : sorted.slice(0, 2);
const formatIt = (d: Date) => d.toLocaleDateString("it-IT", { year: "numeric", month: "long", day: "2-digit" });
---

<BaseLayout
  title="Home"
  description="Wedding films emozionali e cinematografici. Un racconto autentico, elegante, senza tempo."
>
  <!-- HERO (video vibe placeholder) -->
  <section class="relative min-h-[86svh] flex items-end">
    <HeroMedia videoSrc={import.meta.env.PUBLIC_HERO_VIDEO_URL ?? ""} posterSrc={import.meta.env.PUBLIC_HERO_POSTER_URL ?? ""} />

    <div class="section-pad relative w-full pb-14 sm:pb-20">
      <div class="max-w-2xl motion-safe:animate-[fadeUp_.35s_ease-out_both]">
        <p class="text-xs tracking-[0.22em] uppercase text-white/70">Valentina Angeli — Wedding Filmmaker</p>

        <h1 class="mt-4 text-4xl sm:text-6xl font-semibold tracking-tight text-white">
          Uso il mio cuore<br class="hidden sm:block" />
          per raccontarvi.
        </h1>

        <p class="mt-5 max-w-prose text-white/75">
          Uso attenzione, tempo e presenza<br />
          per custodire ciò che accade davvero.
        </p>

        <div class="mt-8 flex flex-col gap-3 sm:flex-row">
          <a
            class="inline-flex items-center justify-center rounded-full bg-white px-6 py-3 text-sm font-medium text-zinc-900 transition duration-200 hover:opacity-90"
            href={site.cta.primaryHref}
          >
            Raccontiamo la vostra storia
          </a>
          <a
            class="inline-flex items-center justify-center rounded-full border border-white/35 px-6 py-3 text-sm font-medium text-white transition duration-200 hover:bg-white/10"
            href="/portfolio"
          >
            Guarda le storie
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- HOW I TELL YOUR STORIES -->
  <section class="section-pad py-14 sm:py-20">
    <div class="max-w-3xl">
      <h2 class="text-2xl sm:text-3xl font-semibold tracking-tight">Come vi racconto</h2>
      <div class="mt-6 space-y-2 text-zinc-700">
        <p>Vi accompagno senza chiedervi gesti o pose.</p>
        <p>Ascolto quello che accade, senza interferire.</p>
        <p>Vi lascio liberi di essere voi stessi.</p>
        <p class="pt-2">
          Il mio lavoro è stare lì mentre le cose succedono.<br />
          E proteggerle, così come sono.
        </p>
      </div>

      <div class="mt-8">
        <a class="inline-flex items-center gap-2 text-sm font-medium text-zinc-900 hover:opacity-70 transition duration-200"
          href="/come-vi-racconto">
          Leggi come lavoro <span aria-hidden="true">→</span>
        </a>
      </div>
    </div>
  </section>

  <div class="border-t border-zinc-200"></div>

  <!-- YOUR STORIES -->
  <section class="section-pad py-16 sm:py-24">
    <header class="max-w-2xl">
      <h2 class="text-2xl sm:text-3xl font-semibold tracking-tight">Le vostre storie</h2>
      <p class="mt-5 text-zinc-700 max-w-prose">
        Ogni film di matrimonio nasce da una relazione reale.
        Dal tempo passato insieme, dal coraggio di scegliersi ogni giorno.
      </p>
    </header>
    <div class="mt-12 grid gap-7 lg:grid-cols-2">
      {picks.map((entry) => (
        <StoryCard
          href={`/portfolio/${entry.slug}`}
          title={entry.data.title}
          excerpt={entry.data.excerpt}
          location={entry.data.location}
          dateLabel={formatIt(toDate(entry.data.date))}
          youtubeId={entry.data.youtubeId}
          poster={entry.data.poster}
          featured={entry.data.featured}
        />
      ))}
    </div>
    <div class="mt-10">
      <a
        class="inline-flex items-center gap-2 text-sm font-medium text-zinc-900 hover:opacity-70 transition duration-200"
        href="/portfolio"
      >
        Vai al portfolio <span aria-hidden="true">→</span>
      </a>
    </div>
  </section>

  <div class="border-t border-zinc-200"></div>

  <!-- TESTIMONIALS -->
  <section class="section-pad py-16 sm:py-24">
    <h2 class="text-2xl sm:text-3xl font-semibold tracking-tight">Parole vere</h2>
    <p class="mt-5 max-w-prose text-zinc-700">
      Qui parlano le coppie che ho accompagnato. Di come si sono sentite nel percorso fatto insieme,
      del clima, della fiducia, dello spazio che hanno avuto per essere sé stesse.
    </p>

    <figure class="mt-10 max-w-3xl">
      <blockquote class="text-lg sm:text-xl leading-relaxed text-zinc-900">
        “Ci siamo rivisti in ogni dettaglio. Un film che sembra respirare con noi.”
      </blockquote>
      <figcaption class="mt-4 text-sm text-zinc-500">A. & L.</figcaption>

      <div class="mt-8 flex gap-4 text-sm">
        <a class="text-zinc-900 hover:opacity-70 transition duration-200" href="/portfolio">
          Leggi altre storie →
        </a>
      </div>
    </figure>

  </section>

  <!-- FINAL CTA -->
  <section class="section-pad py-16 sm:py-24">
    <div class="rounded-3xl bg-zinc-950 px-7 py-10 sm:px-10 sm:py-12">
      <div class="max-w-2xl motion-safe:animate-[fadeUp_.35s_ease-out_both]">
        <h2 class="text-2xl sm:text-3xl font-semibold tracking-tight text-white">
          Siete pronti a condividere la vostra storia?
        </h2>
        <div class="mt-5 space-y-2 text-white/75 max-w-prose">
          <p>Se sentite che questo modo di raccontare vi somiglia davvero, il primo passo è semplice.</p>
          <p>Ci prendiamo del tempo. Parliamo. Vediamo se siamo la scelta giusta, per entrambi.</p>
        </div>

        <div class="mt-8 flex flex-col gap-3 sm:flex-row">
          <a
            class="inline-flex items-center justify-center rounded-full bg-white px-6 py-3 text-sm font-medium text-zinc-900 transition duration-200 hover:opacity-90"
            href={site.cta.primaryHref}
          >
            Prenota una call conoscitiva
          </a>
          <a
            class="inline-flex items-center justify-center rounded-full border border-white/25 px-6 py-3 text-sm font-medium text-white transition duration-200 hover:bg-white/10"
            href="/contatti"
          >
            Contatti
          </a>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>