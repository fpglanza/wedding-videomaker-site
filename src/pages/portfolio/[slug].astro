---
import BaseLayout from "../../layouts/BaseLayout.astro";
import LazyYouTube from "../../components/LazyYouTube.astro";
import { getCollection, render } from "astro:content";

export async function getStaticPaths() {
  const stories = await getCollection("stories");
  return stories.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;

const toDate = (d) => (d instanceof Date ? d : new Date(String(d)));
const date = toDate(entry.data.date);

const { Content } = await render(entry);
---

<BaseLayout title={entry.data.title} description={entry.data.excerpt}>
  <section class="section-pad py-10 sm:py-14">
    <a href="/portfolio" class="text-sm text-zinc-600 hover:text-zinc-900 transition duration-200">
      ← Torna a Le vostre storie
    </a>
  </section>

  <article class="section-pad pb-16 sm:pb-24">
    <header class="max-w-3xl">
      <h1 class="text-3xl sm:text-5xl font-semibold tracking-tight">
        {entry.data.title}
      </h1>

      <div class="mt-5 flex flex-wrap items-center gap-x-4 gap-y-2 text-sm text-zinc-600">
        {entry.data.location ? <span>{entry.data.location}</span> : null}
        <span aria-hidden="true">•</span>
        <time datetime={date.toISOString()}>
          {date.toLocaleDateString("it-IT", { year: "numeric", month: "long", day: "2-digit" })}
        </time>
      </div>

      <p class="mt-6 text-zinc-700 max-w-prose">
        {entry.data.excerpt}
      </p>
    </header>

    <div class="mt-10 max-w-4xl">
      <LazyYouTube youtubeId={entry.data.youtubeId} title={entry.data.title} poster={entry.data.poster} />
    </div>

    <div class="mt-12 max-w-3xl prose prose-zinc prose-headings:tracking-tight prose-a:text-zinc-900">
      <Content />
    </div>
  </article>
</BaseLayout>