---
import BaseLayout from "../../layouts/BaseLayout.astro";
import StoryCard from "../../components/StoryCard.astro";
import { getCollection } from "astro:content";

const stories = await getCollection("stories");

const toDate = (d: unknown) => (d instanceof Date ? d : new Date(String(d)));

const sorted = stories
  .slice()
  .sort((a, b) => toDate(b.data.date).getTime() - toDate(a.data.date).getTime());

const formatIt = (d: Date) =>
  d.toLocaleDateString("it-IT", { year: "numeric", month: "long", day: "2-digit" });
---

<BaseLayout title="Le vostre storie" description="Una selezione di wedding stories: film emozionali, autentici, cinematografici.">
  <section class="section-pad py-14 sm:py-20">
    <header class="max-w-2xl">
      <h1 class="text-3xl sm:text-4xl font-semibold tracking-tight">Le vostre storie</h1>
      <p class="mt-5 text-zinc-700">
        Sei racconti per entrare nel ritmo: dettagli, sguardi, silenzi. Ogni storia è un film, non un “reportage”.
      </p>
    </header>

    <div class="mt-12 grid gap-6 lg:grid-cols-2">
      {sorted.map((entry) => {
        const href = `/portfolio/${entry.slug}`;
        const d = toDate(entry.data.date);

        return (
          <StoryCard
            href={href}
            title={entry.data.title}
            excerpt={entry.data.excerpt}
            location={entry.data.location}
            dateLabel={formatIt(d)}
            youtubeId={entry.data.youtubeId}
            poster={entry.data.poster}
            featured={entry.data.featured}
          />
        );
      })}
    </div>
  </section>
</BaseLayout>